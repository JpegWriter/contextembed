# Pillar 3: AI-Structured Context

## Definition

AI-Structured Context refers to the metadata fields generated by AI vision analysis (GPT-4V) that describe what's in the image. These are secondary to proof-first fields — they add discoverability and semantic richness, but don't constitute proof of work.

The structure follows IPTC standards for interoperability while adding custom fields for intent, emotional tone, and scene classification.

---

## Implementation Locations

| Component | File Path | Purpose |
|-----------|-----------|---------|
| Vision Analysis | `packages/core/src/pipeline/vision.ts` | GPT-4V image analysis |
| Metadata Synthesis | `packages/core/src/pipeline/synthesis.ts` | Combines vision + context |
| Field Mapping | `packages/metadata/src/field-mapper.ts` | Maps to IPTC/XMP fields |
| Job Runner | `apps/api/src/services/job-runner.ts` | Orchestrates analysis pipeline |
| Contract Types | `packages/metadata/src/iptc-contract.ts` | IPTC field definitions |

---

## Metadata Fields

### IPTC Core (AI-Generated)

| Field | Constraint | Source |
|-------|------------|--------|
| `ObjectName` | ≤60 chars | Brand + Session + Subject |
| `Caption-Abstract` | 200-1200 chars | AI-synthesized description |
| `Keywords` | 5-15 items, ≤24 chars each | AI-extracted + sanitized |
| `City` | ≤80 chars | From onboarding or EXIF |
| `Country` | ≤80 chars | From onboarding or EXIF |

### XMP AI Classification

| XMP Field | Purpose |
|-----------|---------|
| `XMP-contextembed:SceneType` | Scene classification (portrait, wedding, product) |
| `XMP-contextembed:PrimarySubjects` | Who/what is in the image |
| `XMP-contextembed:EmotionalTone` | Mood descriptor |
| `XMP-contextembed:Intent` | Purpose (portfolio, commercial, editorial) |
| `XMP-contextembed:VisionConfidenceScore` | AI confidence 0-100 |
| `XMP-contextembed:SafetyValidated` | Boolean for sensitive content check |

### Intent Fields (AEO-Adjacent)

| Field | Location | Purpose |
|-------|----------|---------|
| `intent.purpose` | UserComment JSON | portfolio/commercial/editorial |
| `intent.narrativeRole` | SpecialInstructions | Story context |
| `intent.emotionalTone` | UserComment JSON | Mood for AI context |
| `intent.momentType` | UserComment JSON | Scene classification |

---

## Database Tables

| Table | Field | Purpose |
|-------|-------|---------|
| `vision_results` | `result` (JSON) | Raw GPT-4V response |
| `metadata_results` | `result` (JSON) | Synthesized metadata |
| `assets` | `status` | Processing state |
| `jobs` | `type`, `status` | Pipeline orchestration |

---

## Export Behavior

1. **Vision analysis**: GPT-4V analyzes image
2. **Synthesis**: Vision + business context combined
3. **Field mapping**: Mapped to IPTC + XMP fields
4. **Contract creation**: `toMetadataContract()` builds full contract
5. **Tag writing**: All fields written via ExifTool

---

## Risks

| Risk | Severity | Mitigation |
|------|----------|------------|
| AI hallucination | MEDIUM | Human review before export |
| Keyword stuffing | LOW | Spam filter + 15 keyword limit |
| Caption too generic | LOW | Business context injection |
| AEO claims overstated | MEDIUM | Marketing clarification needed |

---

## AEO Status

The "AEO-Ready" claim is **PARTIAL**:

- ✅ Intent fields exist
- ✅ EmotionalTone captured
- ❌ No AEO-specific prompt engineering
- ❌ No schema.org structured data
- ❌ Goal="seo_aeo" doesn't change synthesis

---

## Maturity Level

**⚠️ PARTIAL**

- AI synthesis pipeline works
- IPTC fields written correctly
- Custom XMP fields for classification
- AEO optimization is aspirational, not implemented
